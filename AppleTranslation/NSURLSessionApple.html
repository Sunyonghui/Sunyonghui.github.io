<!doctype html>




<html class="theme-next pisces" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


 




<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />


 

  <meta name="google-site-verification" content="tJ1b_5K4s886Dj_mMP2tyEHgak2WOqILA5ZEH-a61GA" />



  <meta name="baidu-site-verification" content="KZ14MEYWgk" />


 







  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="è¯‘æ–‡," />





  <link rel="alternate" href="/atom.xml" title="å››æ—¶äº”å‘³ï¼Œå†·æš–è‡ªçŸ¥" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/images/logo.jpg?v=5.1.1" />






<meta name="description" content="Write in the firstã€å†™åœ¨æœ€å‰ã€‘ ç”±äº X X (è‡ªåŠ¨è„‘è¡¥) çš„è‹¹æœåœ¨ iOS9 ä¹‹åå·²ç»åºŸå¼ƒäº† NSURLConnectionï¼Œæ‰€ä»¥åœ¨ç°åœ¨çš„å®é™…å¼€å‘ä¸­ï¼Œé™¤äº†å¤§å®¶å¸¸è§çš„ AFN æ¡†æ¶ï¼Œä¸€èˆ¬ä½¿ç”¨çš„æ˜¯ iOS7 ä¹‹åæ¨å‡ºçš„ NSURLSessionï¼Œä½œä¸ºä¸€å iOS å¼€å‘è€…ï¼Œå¦‚æœä½ åªçŸ¥é“ AFN æ¡†æ¶æ¥è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œé‚£å°± X x äº†ã€‚ åœ¨ã€Œæ—¶é—´ &amp;amp; çŸ¥è¯† ã€æœ‰é™å†…ï¼Œæ€»ç»“çš„æ–‡ç« éš¾">
<meta name="keywords" content="è¯‘æ–‡">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS NSURLSessionAppleè¯‘æ–‡">
<meta property="og:url" content="http://yoursite.com/AppleTranslation/NSURLSessionApple.html">
<meta property="og:site_name" content="å››æ—¶äº”å‘³ï¼Œå†·æš–è‡ªçŸ¥">
<meta property="og:description" content="Write in the firstã€å†™åœ¨æœ€å‰ã€‘ ç”±äº X X (è‡ªåŠ¨è„‘è¡¥) çš„è‹¹æœåœ¨ iOS9 ä¹‹åå·²ç»åºŸå¼ƒäº† NSURLConnectionï¼Œæ‰€ä»¥åœ¨ç°åœ¨çš„å®é™…å¼€å‘ä¸­ï¼Œé™¤äº†å¤§å®¶å¸¸è§çš„ AFN æ¡†æ¶ï¼Œä¸€èˆ¬ä½¿ç”¨çš„æ˜¯ iOS7 ä¹‹åæ¨å‡ºçš„ NSURLSessionï¼Œä½œä¸ºä¸€å iOS å¼€å‘è€…ï¼Œå¦‚æœä½ åªçŸ¥é“ AFN æ¡†æ¶æ¥è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œé‚£å°± X x äº†ã€‚ åœ¨ã€Œæ—¶é—´ &amp;amp; çŸ¥è¯† ã€æœ‰é™å†…ï¼Œæ€»ç»“çš„æ–‡ç« éš¾">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/2230763-d502586dda92f310.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2017-07-15T01:41:00.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS NSURLSessionAppleè¯‘æ–‡">
<meta name="twitter:description" content="Write in the firstã€å†™åœ¨æœ€å‰ã€‘ ç”±äº X X (è‡ªåŠ¨è„‘è¡¥) çš„è‹¹æœåœ¨ iOS9 ä¹‹åå·²ç»åºŸå¼ƒäº† NSURLConnectionï¼Œæ‰€ä»¥åœ¨ç°åœ¨çš„å®é™…å¼€å‘ä¸­ï¼Œé™¤äº†å¤§å®¶å¸¸è§çš„ AFN æ¡†æ¶ï¼Œä¸€èˆ¬ä½¿ç”¨çš„æ˜¯ iOS7 ä¹‹åæ¨å‡ºçš„ NSURLSessionï¼Œä½œä¸ºä¸€å iOS å¼€å‘è€…ï¼Œå¦‚æœä½ åªçŸ¥é“ AFN æ¡†æ¶æ¥è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œé‚£å°± X x äº†ã€‚ åœ¨ã€Œæ—¶é—´ &amp;amp; çŸ¥è¯† ã€æœ‰é™å†…ï¼Œæ€»ç»“çš„æ–‡ç« éš¾">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/2230763-d502586dda92f310.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":true,"scrollpercent":true},
    fancybox: true,
    motion: false,
    duoshuo: {
      userId: 'undefined',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



<script>
    (function(){
        if(''){
            if (prompt('è¯·è¾“å…¥æ–‡ç« å¯†ç ') !== ''){
                alert('å¯†ç é”™è¯¯ï¼');
                history.back();
            }
        }
    })();
</script>







  <link rel="canonical" href="http://yoursite.com/AppleTranslation/NSURLSessionApple.html"/>





  <title> iOS NSURLSessionAppleè¯‘æ–‡ | å››æ—¶äº”å‘³ï¼Œå†·æš–è‡ªçŸ¥ </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">å››æ—¶äº”å‘³ï¼Œå†·æš–è‡ªçŸ¥</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      
        
        <li class="menu-item menu-item-guestbook">
          <a href="/guestbook" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-commenting"></i> <br />
            
            å…³äº
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            æœç´¢
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>










 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/AppleTranslation/NSURLSessionApple.html">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="æ— å‘³sh">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="å››æ—¶äº”å‘³ï¼Œå†·æš–è‡ªçŸ¥">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="å››æ—¶äº”å‘³ï¼Œå†·æš–è‡ªçŸ¥" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h2 class="post-title" itemprop="name headline">
            
            
              
                iOS NSURLSessionAppleè¯‘æ–‡
              
            
          </h2>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-03-15T00:00:00+08:00">
                2016-03-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/è¯‘æ–‡/" itemprop="url" rel="index">
                    <span itemprop="name">è¯‘æ–‡</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a class="cloud-tie-join-count" href="/AppleTranslation/NSURLSessionApple.html#comments" itemprop="discussionUrl">
                  <span class="post-comments-count join-count" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/AppleTranslation/NSURLSessionApple.html" class="leancloud_visitors" data-flag-title="iOS NSURLSessionAppleè¯‘æ–‡">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">Reading </span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          
            <div class="post-wordcount">




	<noscript>æ·»åŠ å­—æ•°ç»Ÿè®¡å’Œé˜…è¯»æ—¶é•¿</noscript>

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                  
                    <span class="post-meta-item-text">Count</span>
		    &nbsp;<i class="fa fa-heartbeat"></i>&nbsp;
                  
                    <span title="post.wordcount" }}">
                      6,411 W
                    </span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                  
                    <span class="post-meta-item-text">Time</span>
		    &nbsp;<i class="fa fa-heartbeat"></i>&nbsp;
                  
                    <span title="post.min2read" }}">
                      27 M
                    </span>
              

	<noscript>æ·»åŠ å­—æ•°ç»Ÿè®¡å’Œé˜…è¯»æ—¶é•¿</noscript>



            </div>
          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h4 id="Write-in-the-firstã€å†™åœ¨æœ€å‰ã€‘"><a href="#Write-in-the-firstã€å†™åœ¨æœ€å‰ã€‘" class="headerlink" title="Write in the firstã€å†™åœ¨æœ€å‰ã€‘"></a>Write in the firstã€å†™åœ¨æœ€å‰ã€‘</h4><hr>
<p>ç”±äº X X (è‡ªåŠ¨è„‘è¡¥) çš„è‹¹æœåœ¨ <code>iOS9</code> ä¹‹åå·²ç»åºŸå¼ƒäº† <code>NSURLConnection</code>ï¼Œæ‰€ä»¥åœ¨ç°åœ¨çš„å®é™…å¼€å‘ä¸­ï¼Œé™¤äº†å¤§å®¶å¸¸è§çš„ <code>AFN æ¡†æ¶</code>ï¼Œä¸€èˆ¬ä½¿ç”¨çš„æ˜¯ <code>iOS7</code> ä¹‹åæ¨å‡ºçš„ <code>NSURLSession</code>ï¼Œä½œä¸ºä¸€å <code>iOS å¼€å‘è€…</code>ï¼Œå¦‚æœä½ åªçŸ¥é“ <code>AFN æ¡†æ¶</code>æ¥è¿›è¡Œç½‘ç»œè¯·æ±‚ï¼Œé‚£å°± X x äº†ã€‚</p>
<p>åœ¨ã€Œæ—¶é—´ &amp; çŸ¥è¯† ã€æœ‰é™å†…ï¼Œæ€»ç»“çš„æ–‡ç« éš¾å…æœ‰ã€Œæœªå…¨ã€ä¸è¶³ ã€çš„åœ°æ–¹ï¼Œè¿˜æœ›å„ä½å¥½å‹æŒ‡å‡ºï¼Œä»¥æé«˜æ–‡ç« è´¨é‡ğŸ”ç™½å¼€æ°´lnã€‚</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2230763-d502586dda92f310.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="ï£¿"></p>
<h4 id="æ­£é¢˜"><a href="#æ­£é¢˜" class="headerlink" title="æ­£é¢˜"></a>æ­£é¢˜</h4><p>åœ¨è¿™é‡Œé¦–å…ˆé™„ä¸Šå®˜æ–¹åŸæ–‡åœ°å€ <a href="https://developer.apple.com/reference/foundation/urlsession#//apple_ref/occ/clm/NSURLSession/sharedSession" target="_blank" rel="external">URLSession Class</a></p>
<table>
<thead>
<tr>
<th style="text-align:center">Relationships</th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Inherits From  NSObject</td>
<td style="text-align:left">ç»§æ‰¿è‡ª: NSObject</td>
</tr>
<tr>
<td style="text-align:center">Conforms To</td>
<td style="text-align:left">CVarArgï¼ŒEquatableï¼ŒHashable</td>
</tr>
<tr>
<td style="text-align:center">Framework</td>
<td style="text-align:left">iOS 7.0+</td>
</tr>
</tbody>
</table>
<p><strong>Class</strong><br><strong> URLSession</strong></p>
<blockquote>
<p>The NSURLSession class and related classes provide an API for downloading content. This API provides a rich set of delegate methods for supporting authentication and gives your app the ability to perform background downloads when your app is not running or, in iOS, while your app is suspended.</p>
</blockquote>
<p><code>NSURLSession</code> ç±»åŠå…¶ç›¸å…³ç±»ä¸ºä¸‹è½½å†…å®¹æä¾›äº†æ¥å£ã€‚è¿™ä¸ª API æä¾›äº†ä¸€ç³»åˆ—ä¸°å¯Œçš„ä»£ç†æ–¹æ³•æ¥æ”¯æŒæˆæƒï¼Œè€Œä¸”è®©ä½ çš„ APP åœ¨åå°è¢«æŒ‚èµ·æ—¶ä¹Ÿèƒ½ç»§ç»­ä¸‹è½½ã€‚</p>
<p><strong>Overview</strong></p>
<blockquote>
<p>The <code>URLSession</code> class natively supports the data, file, ftp, http, and https URL schemes, with transparent support for proxy servers and SOCKS gateways, as configured in the userâ€™s system preferences.</p>
<p>URLSession supports the HTTP/1.1, SPDY, and HTTP/2 protocols. HTTP/2 support is described by RFC 7540, and requires a server supporting either ALPN or NPN for protocol negotiation.</p>
<p>You can also add support for your own custom networking protocols and URL schemes (for your appâ€™s private use) using <code>URLProtocol</code>.</p>
</blockquote>
<p>é€šè¿‡ä»£ç†æœåŠ¡å™¨çš„å’Œ SOCKS ç½‘å…³ä¸ºç”¨æˆ·é…ç½®å¥½ç³»ç»Ÿè®¾ç½®ï¼Œ<a href="https://developer.apple.com/reference/foundation/urlsession" target="_blank" rel="external">NSURLSession</a>ç±»å®Œå…¨æ”¯æŒ data, file, ftp, http, httpsç±»å‹çš„è¶…é“¾æ¥ã€‚ä½ ä¹Ÿå¯ä»¥æ·»åŠ ä¸€äº›æ”¯æŒä½ è‡ªå·±å®šåˆ¶çš„ç½‘ç»œ<a href="https://developer.apple.com/reference/foundation/urlprotocol" target="_blank" rel="external">åè®®</a>æˆ–è¶…é“¾æ¥ï¼ˆä¸“é—¨ä¸ºä½ è‡ªå·±çš„ APP æ‰€ç”¨ï¼‰</p>
<blockquote>
<p>Important<br>The NSURLSession API involves many different classes working together in a fairly complex way that may not be obvious if you read the reference documentation by itself. Before using this API, you should read   URL Session Programming Guide   to gain a conceptual understanding of how these classes interact with one another.</p>
</blockquote>
<p>é‡è¦ï¼š<br><code>NSURLSession</code> çš„ API æœ‰å¾ˆå¤šä½ åœ¨çœ‹æ–‡æ¡£æ—¶å¯èƒ½æ„Ÿè§‰å¹¶ä¸é‡è¦ï¼Œä½†å®é™…ä¸Šå´ä»¥å¾ˆå¤æ‚çš„æ–¹å¼æ¥å…±åŒå‘æŒ¥ä½œç”¨çš„ç±»ã€‚ç”¨è¿™ä¸ª API ä¹‹å‰ï¼Œä½ åº”è¯¥çœ‹ä¸€ä¸‹ <a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html#//apple_ref/doc/uid/10000165i" target="_blank" rel="external">URL Session Programming Guide</a> æ¥äº†è§£è¿™äº›ç±»ä¹‹é—´ç›¸äº’è°ƒç”¨çš„ä¸€äº›æ¦‚å¿µã€‚</p>
<blockquote>
<p>With the NSURLSession API, your app creates one or more sessions, each of which coordinates a group of related data transfer tasks. For example, if you are writing a web browser, your app might create one session per tab or window, or one session for interactive use and another session for background downloads. Within each session, your app adds a series of tasks, each of which represents a request for a specific URL (following HTTP redirects if necessary).</p>
</blockquote>
<p>é€šè¿‡ <code>NSURLSession</code> çš„ APIï¼Œä½ çš„ APPå¯ä»¥åˆ›å»ºä¸€ä¸ªæˆ–è€…å¤šä¸ªäº‹åŠ¡ï¼Œå…¶ä¸­çš„æ¯ä¸€ä¸ªäº‹åŠ¡éƒ½ç”¨æ¥ååŠ©ä¸€ç»„ç›¸å…³çš„æ•°æ®æ¥ä¼ è¾“ä»»åŠ¡ã€‚æ¯”å¦‚ï¼Œå¦‚æœä½ åœ¨å†™ä¸€ä¸ªæµè§ˆå™¨ï¼Œä½ çš„ APP å¯èƒ½åœ¨æ¯ä¸€æ æˆ–æ˜¯æ¯ä¸€ä¸ªçª—å£éƒ½åˆ›å»ºäº†ä¸€ä¸ªäº‹åŠ¡ï¼Œå¯èƒ½ä¸€ä¸ªç”¨æ¥è¿›è¡Œäº¤äº’ï¼Œä¸€ä¸ªç”¨æ¥åå°ä¸‹è½½ã€‚åœ¨æ¯ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œä½ çš„ APP éƒ½æ·»åŠ äº†ä¸€äº›äº†çš„ä»»åŠ¡ï¼Œå…¶ä¸­çš„æ¯ä¸€ä¸ªä»»åŠ¡å°±ä»£è¡¨ä¸€ä¸ªè¯·æ±‚æˆ–æ˜¯ä¸€ä¸ªç‰¹å®šçš„ URLï¼ˆå¿…è¦æ—¶è¿›è¡ŒHTTPé‡å®šå‘ï¼‰</p>
<blockquote>
<p>The tasks within a given URL session share a common session configuration object, which defines connection behavior, such as the maximum number of simultaneous connections to make to a single host, whether to allow connections over a cellular network, and so on. The behavior of a session is determined in part by which method you call when creating its configuration object:</p>
<ul>
<li>The singleton shared session (which has no configuration object) is for basic requests. It is not as customizable as sessions that you create, but it serves as a good starting point if you have very limited requirements. You access this session by calling the <code>shared</code> class method. See that methodâ€™s discussion for more information about its limitations.</li>
<li>Default sessions behave much like the shared session (unless you customize them further), but let you obtain data incrementally using a delegate. You can create a default session configuration by calling the <code>default</code> method on the <code>URLSessionConfiguration</code> class.</li>
<li>Ephemeral sessions are similar to default sessions, but do not write caches, cookies, or credentials to disk. You can create an ephemeral session configuration by calling the <code>ephemeral</code> method on the <code>URLSessionConfiguration</code> class.</li>
<li>Background sessions let you perform uploads and downloads of content in the background while your app is not running. You can create a background session configuration by calling the <code>backgroundSessionConfiguration(_:)</code> method on the <code>URLSessionConfiguration</code> class.</li>
</ul>
</blockquote>
<p>ç»™å®š URLäº‹åŠ¡çš„è¿™äº›ä»»åŠ¡å…±äº«ä¸€ä¸ªäº‹åŠ¡é…ç½® sessionï¼Œè¿™ä¸ªå¯¹è±¡å®šä¹‰å¥½äº†è¿æ¥è¡Œä¸ºï¼Œæ¯”å¦‚é€šå¾€åŒä¸€ä¸ªä¸»æœºçš„ç›¸ä¼¼è¿æ¥çš„æœ€å¤§è¿æ¥æ•°ï¼Œä¸ç®¡æ˜¯é€šè¿‡èœ‚çªç§»åŠ¨ç½‘ç»œè¿˜æ˜¯åˆ«çš„æ–¹å¼æ¥å…è®¸è¿æ¥ã€‚session çš„è¡Œä¸ºä¸€éƒ¨åˆ†æ˜¯ç”±åˆ›å»ºè¿™ä¸ªé…ç½®å¯¹è±¡æ—¶ä½ è°ƒç”¨çš„æ–¹æ³•æ¥å†³å®šï¼š</p>
<ul>
<li><p>å•ä¾‹ shared session ï¼ˆæ²¡æœ‰é…ç½®å¯¹è±¡ï¼‰ç”¨äºæ™®é€šè¯·æ±‚ã€‚å®ƒåƒä½ è‡ªå·±åˆ›å»ºçš„sessionä¸€æ ·å¯å®šåˆ¶ï¼Œä½†æ˜¯å¦‚æœä½ çš„è¯·æ±‚æœ‰é™çš„è¯å®ƒæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„èµ·ç‚¹ï¼Œé€šè¿‡è°ƒç”¨ sharedSession æ¥è·å–è¿™ä¸ª sessionã€‚çœ‹è¿™ä¸ªæ–¹æ³•çš„æ–‡æ¡£æ¥å¾—åˆ°å®ƒçš„ä¸€äº›é™åˆ¶ä¿¡æ¯ã€‚</p>
</li>
<li><p>Default sessions çš„è¡Œä¸ºå’Œ shared session å·®ä¸å¤šï¼ˆé™¤éä½ è‡ªå·±è¿›è¡Œäº†æ·±åº¦å®šåˆ¶ï¼‰ï¼Œä½†ä½ å¿…é¡»è¦é€šè¿‡ä»£ç†æ–¹æ³•å¾—åˆ°å¢é‡æ•°æ®ã€‚è°ƒç”¨ <a href="https://developer.apple.com/reference/foundation/urlsessionconfiguration" target="_blank" rel="external">NSURLSessionConfiguration</a>  ä¸­çš„ defaultSessionConfiguration æ–¹æ³•æ¥åˆ›å»º <a href="https://developer.apple.com/reference/foundation/urlsessionconfiguration/1411560-default" target="_blank" rel="external">Default</a> sessionã€‚</p>
</li>
<li><p>Ephemeral sessionså’ŒDefault sessions å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯ä¸å†™å…¥ caches,cookies, æˆ–credentialsã€‚<br>è°ƒç”¨ <a href="https://developer.apple.com/reference/foundation/urlsessionconfiguration" target="_blank" rel="external">NSURLSessionConfiguration</a>  ä¸­çš„ ephemeral Session Configuration æ–¹æ³•æ¥åˆ›å»º <a href="https://developer.apple.com/reference/foundation/urlsessionconfiguration/1410529-ephemeral" target="_blank" rel="external">ephemeral</a> sessionã€‚</p>
</li>
<li><p>Background sessions å¯ä»¥åœ¨ä½ çš„ APP åœ¨åå°è¢«æŒ‚èµ·æ—¶è¿›è¡Œä¸Šä¼ æˆ–ä¸‹è½½ã€‚è°ƒç”¨ <a href="https://developer.apple.com/reference/foundation/urlsessionconfiguration" target="_blank" rel="external">NSURLSessionConfiguration</a> ä¸­çš„ <a href="https://developer.apple.com/reference/foundation/urlsessionconfiguration/1411521-backgroundsessionconfiguration" target="_blank" rel="external">backgroundSessionConfiguration: </a> æ–¹æ³•æ¥åˆ›å»º background sessionã€‚</p>
</li>
</ul>
<blockquote>
<p>The session configuration object also contains a reference to URL cache and cookie storage objects that may be used when making requests and handling the responses, depending on the configuration and request type.</p>
</blockquote>
<p>session é…ç½®å¯¹è±¡è¿˜åŒ…å«äº†å¯¹ URL cache å’Œ cookie å­˜å‚¨å¯¹è±¡å‘èµ·è¯·æ±‚å¹¶å¤„ç†ç›¸åº”çš„å¼•ç”¨ï¼Œå…·ä½“å–å†³äºé…ç½®å’Œè¯·æ±‚ç±»å‹ã€‚</p>
<blockquote>
<p>The tasks in a session also share a common delegate that lets you provide and obtain information when various events occurâ€”when authentication fails, when data arrives from the server, when data is ready to be cached, and so on. For all background downloads and uploads, you must provide a delegate that conforms to the <code>URLSessionDownloadDelegate</code>Objective-C protocol. Otherwise, if you donâ€™t need any of the features provided by a delegate, you can use this API without providing a delegate by passing nil when you create a session.</p>
</blockquote>
<p>å½“å¤šç§ç±»å‹çš„äº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆæ¯”å¦‚æˆæƒå¤±è´¥æ—¶ï¼Œæ•°æ®ä¼ è¾“åˆ°æœåŠ¡å™¨æ—¶ï¼Œæ•°æ®å‡†å¤‡å¥½ç¼“å­˜æ—¶ç­‰ç­‰ï¼‰session ä¸­çš„ä»»åŠ¡ä¹Ÿä¼šå…±äº«ä¸€ä¸ªé€šç”¨çš„ä»£ç†æ¥è®©ä½ æä¾›å’Œè·å–ç›¸å…³ä¿¡æ¯ã€‚å¯¹äºæ‰€æœ‰çš„åå°ä¸‹è½½å’Œä¸Šä¼ ï¼Œä½ å¿…é¡»æä¾›ä¸€ä¸ªéµä» <a href="https://developer.apple.com/reference/foundation/urlsessiondownloaddelegate" target="_blank" rel="external">NSURLSessionDownloadDelegate</a>çš„ OC åè®®ã€‚å¦åˆ™ï¼Œå¦‚æœä½ ä¸éœ€è¦ä»»ä½•ç”±ä»£ç†æä¾›çš„ç‰¹æ€§ï¼Œåœ¨ä½ åˆ›å»º session æ—¶å°±ç»™ delegate ä¼  nil æ¥è°ƒç”¨è¿™ä¸ª APIã€‚</p>
<blockquote>
<p>Important<br>The session object keeps a strong reference to the delegate until your app exits or explicitly invalidates the session. If you do not invalidate the session, your app leaks memory until it exits.</p>
</blockquote>
<p>é‡è¦ï¼š<br>session å¯¹ä½ çš„ delegate å§‹ç»ˆä¿æŒå¼ºå¼•ç”¨ï¼Œé™¤éä½ çš„ app é€€å‡ºæˆ–è€… sessionå·²æ˜ç¡®å¤±æ•ˆã€‚å¦‚æœä½ æ²¡æœ‰ä½¿ session å¤±æ•ˆï¼Œä½ çš„ app å°†ä¼šå†…å­˜æº¢å‡ºï¼Œç›´åˆ°å®ƒç»ˆæ­¢ã€‚</p>
<blockquote>
<p>Within a session, you create tasks that optionally upload data to a server, then retrieve data from the server either as a file on disk or as one or more NSData objects in memory. The NSURLSession API provides three types of tasks:</p>
<ul>
<li>Data tasks send and receive data using NSData objects. Data tasks are intended for short, often interactive requests to a server.</li>
<li>Upload tasks are similar to data tasks, but they also send data (often in the form of a file), and support background uploads while the app is not running.</li>
<li>Download tasks retrieve data in the form of a file, and support background downloads and uploads while the app is not running.</li>
</ul>
</blockquote>
<p>åœ¨ <code>session</code> ä¸­ï¼Œä½ åˆ›å»ºäº†å¯ä¸Šä¼ æ•°æ®åˆ°æœåŠ¡å™¨çš„ä»»åŠ¡ï¼Œç„¶åé€šè¿‡ç£ç›˜ä¸Šçš„æ–‡ä»¶ï¼Œæˆ–æ˜¯å†…å­˜ä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ª NSData å¯¹è±¡æ¥è·å–æ•°æ®ã€‚ <code>NSURLSession</code> çš„ API æä¾›äº†ä¸‰ç§ç±»å‹çš„ä»»åŠ¡ï¼š</p>
<ul>
<li><code>data tasks</code> é€šè¿‡ <code>NSData</code> å¯¹è±¡æ¥å‘é€å’Œæ¥å—æ•°æ®ã€‚ <code>data tasks</code> ç”¨äºä¸æœåŠ¡å™¨è¿›è¡Œç®€çŸ­é¢‘ç¹çš„è¯·æ±‚ã€‚</li>
<li><code>Upload tasks</code> å’Œ <code>data tasks</code> ç±»ä¼¼ï¼Œä½†æ˜¯ä»–ä»¬ä¹Ÿå¯ä»¥å‘é€æ•°æ®ï¼ˆä¸€èˆ¬æ˜¯é€šè¿‡æ–‡ä»¶çš„å½¢å¼ï¼‰ï¼Œä¹Ÿæ”¯æŒ app åå°ä¸Šä¼ ã€‚</li>
<li><code>Download tasks</code> é€šè¿‡æ–‡ä»¶çš„å½¢å¼æ¥è·å–æ•°æ®ï¼Œå¹¶ä¸”æ”¯æŒ app åå°ä¸Šä¼ å’Œä¸‹è½½ã€‚</li>
</ul>
<blockquote>
<p>Like most networking APIs, the NSURLSession API is highly asynchronous. It returns data to your app in one of two ways, depending on the methods you call:</p>
<ul>
<li>To a completion handler block that is called when a transfer finishes successfully or with an error.</li>
<li>By calling methods on the sessionâ€™s delegate as data is received and when the transfer is complete.</li>
</ul>
</blockquote>
<p>å’Œå¤§å¤šæ•°ç½‘ç»œæ¥å£ä¸€æ ·ï¼Œ<code>NSURLSession</code>æ˜¯é«˜åº¦å¼‚æ­¥çš„ã€‚å®ƒé€šè¿‡ä¸¤ç§æ–¹å¼ä¸­çš„å…¶ä¸­ä¸€ç§æ¥è¿”å›æ•°æ®ç»™ appï¼Œå–å†³äºä½ è°ƒç”¨çš„æ–¹æ³•ï¼š</p>
<ul>
<li>å½“ä¼ è¾“æˆåŠŸæˆ–æ˜¯å‘ç”Ÿé”™è¯¯æ—¶è°ƒç”¨ <code>completion handler block</code>ï¼›</li>
<li>å½“æ”¶åˆ°æ•°æ®æˆ–æ˜¯ä¼ è¾“å®Œæˆæ—¶è°ƒç”¨ <code>session çš„ä»£ç†æ–¹æ³•</code>ã€‚</li>
</ul>
<blockquote>
<p>In addition to delivering this information to delegates, the NSURLSession API provides status and progress properties that you can query if you need to make programmatic decisions based on the current state of the task (with the caveat that its state can change at any time).</p>
<p>URL sessions also support canceling, restarting or resuming, and suspending tasks, and provide the ability to resume suspended, canceled, or failed downloads where they left off.</p>
</blockquote>
<p>é™¤äº†é€šè¿‡ä»£ç†æ¥ä¼ é€’æ•°æ®ï¼Œå¦‚æœä½ éœ€è¦é€šè¿‡å½“å‰ä»»åŠ¡çš„çŠ¶æ€ï¼ˆç»™å‡ºä¸€äº›çŠ¶æ€è­¦ç¤ºï¼‰åšä¸€äº›ç¨‹åºä¸Šçš„å†³å®šï¼Œ <code>NSURLSession</code>çš„ API ç»Ÿä¸€æä¾›äº†çŠ¶æ€å’Œè¿›åº¦çš„å±æ€§ï¼Œæ–¹ä¾¿æŸ¥è¯¢ã€‚</p>
<p><code>URL sessions</code> åŒæ ·æ”¯æŒå–æ¶ˆï¼Œé‡å¯ï¼Œæ¢å¤ï¼ŒæŒ‚èµ·ä»»åŠ¡ï¼Œè€Œä¸”å¯ä»¥åœ¨ä»–ä»¬åœæ­¢çš„åœ°æ–¹æ¢å¤æŒ‚èµ·ã€å–æ¶ˆã€å¤±è´¥äº†çš„ä¸‹è½½ã€‚</p>
<p><strong>URL Session Class Hierarchy</strong><br>å±‚çº§ç»“æ„<br>The NSURLSession API consists of the following classes (nested to show subclass relationships):<br><code>NSURLSession API</code> ç”±ä¸‹é¢çš„ç±»ç»„æˆï¼ˆä¸‹é¢çš„ç¼©è¿›æ˜¾ç¤ºçš„æ˜¯å­ç±»çš„å…³ç³»ï¼‰</p>
<ul>
<li><a href="https://developer.apple.com/reference/foundation/urlsession" target="_blank" rel="external">URLSession</a>â€”A session object. ï¼ˆä¸€ä¸ª session å¯¹è±¡ï¼‰</li>
<li><a href="https://developer.apple.com/reference/foundation/urlsessionconfiguration" target="_blank" rel="external">URLSessionConfiguration</a>â€”A configuration object used when initializing the session.ï¼ˆç”¨æ¥åˆå§‹åŒ– session çš„é…ç½®å¯¹è±¡ï¼‰</li>
<li><a href="https://developer.apple.com/reference/foundation/urlsessiontask" target="_blank" rel="external">URLSessionTask</a>â€”The base class for tasks within a session.ï¼ˆåœ¨ session ä¸­è¡¨ç¤ºä»»åŠ¡çš„åŸºç±»ï¼‰<ul>
<li><a href="https://developer.apple.com/reference/foundation/urlsessiondatatask" target="_blank" rel="external">URLSessionDataTask</a>â€”A task for retrieving the contents of a URL as an NSData object.ï¼ˆç”¨æ¥è·å– NSData å¯¹è±¡çš„ URL çš„ä»»åŠ¡ï¼‰<ul>
<li><a href="https://developer.apple.com/reference/foundation/urlsessionuploadtask" target="_blank" rel="external">URLSessionUploadTask</a>â€”A task for uploading a file, then retrieving the contents of a URL as an NSData object.ï¼ˆç”¨æ¥ä¸Šä¼ æ–‡ä»¶ï¼Œå¹¶æ¥æ”¶ NSData å¯¹è±¡çš„ URL çš„ä»»åŠ¡ï¼‰</li>
</ul>
</li>
<li><a href="https://developer.apple.com/reference/foundation/urlsessiondownloadtask" target="_blank" rel="external">URLSessionDownloadTask</a>â€”A task for retrieving the contents of a URL as a temporary file on diskï¼ˆä»¥ç£ç›˜ä¸´æ—¶æ–‡ä»¶çš„å½¢å¼è·å– URL çš„å†…å®¹çš„ä»»åŠ¡ï¼‰</li>
<li><a href="https://developer.apple.com/reference/foundation/urlsessionstreamtask" target="_blank" rel="external">URLSessionStreamTask</a>â€”A task for establishing a TCP/IP connectionï¼ˆç”¨æ¥å»ºç«‹ TCP/IPè¿æ¥çš„ä»»åŠ¡ï¼‰</li>
</ul>
</li>
</ul>
<blockquote>
<p>In addition, the NSURLSession API provides four protocols that define delegate methods your app can implement to provide more fine-grained control over session and task behavior.</p>
</blockquote>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œ<code>NSURLSession</code> è¿˜æä¾›äº†<code>4ä¸ªä»£ç†</code>ï¼Œ è®¢äº†ä»£ç†æ–¹æ³•ï¼Œä½ çš„ app å¯ä»¥å®ç°è¿™äº›ä»£ç†æ–¹æ³•ï¼Œæä¾›å¯¹ session å’Œ task æ›´åŠ ç»†åŒ–çš„æ§åˆ¶ã€‚</p>
<ul>
<li><a href="https://developer.apple.com/reference/foundation/urlsessiondelegate" target="_blank" rel="external">URLSessionDelegate</a>â€”Defines delegate methods to handle session-level eventsï¼ˆå¯å¤„ç† session level äº‹ä»¶çš„ä»£ç†ï¼‰</li>
<li><a href="https://developer.apple.com/reference/foundation/urlsessiontaskdelegate" target="_blank" rel="external">URLSessionTaskDelegate</a>â€”Defines delegate methods to handle task-level events common to all task typesï¼ˆå¯å¤„ç†å’Œå…¶ä»–æ‰€æœ‰ task ç±»å‹ç›¸é€šçš„ task level çš„æ–¹æ³•çš„ä»£ç†ï¼‰</li>
<li><a href="https://developer.apple.com/reference/foundation/urlsessiondatadelegate" target="_blank" rel="external">URLSessionDataDelegate</a>â€”Defines delegate methods to handle task-level events specific to data and upload tasksï¼ˆå¯å¤„ç†ä¸æ•°æ®å’Œä¸Šä¼ ä»»åŠ¡ç›¸å…³çš„ task level çš„æ–¹æ³•çš„ä»£ç†ï¼‰</li>
<li><a href="https://developer.apple.com/reference/foundation/urlsessiondownloaddelegate" target="_blank" rel="external">URLSessionDownloadDelegate</a>â€”Defines delegate methods to handle task-level events specific to download tasksï¼ˆå¤„ç†ä¸ä¸‹è½½ä»»åŠ¡ç›¸å…³çš„ task level çš„æ–¹æ³•çš„ä»£ç†ï¼‰</li>
<li><a href="https://developer.apple.com/reference/foundation/urlsessionstreamdelegate" target="_blank" rel="external">URLSessionStreamDelegate</a>â€”Defines delegate methods to handle task-level events specific to stream tasksï¼ˆå¤„ç†ä¸æ•°æ®æµç›¸å…³çš„ task level çš„æ–¹æ³•çš„ä»£ç†ï¼‰</li>
</ul>
<blockquote>
<p>Finally, the NSURLSession API uses a number of classes that are also commonly used with other APIs such as NSURLConnection and NSURLDownload. Some of these shared classes include:</p>
</blockquote>
<p>æœ€ç»ˆï¼Œ<code>NSURLSession</code> çš„ API ä½¿ç”¨äº†å¾ˆå¤šç±»ï¼Œè¿™äº›ç±»ä¹ŸåŒæ ·ä½¿ç”¨äº†å…¶ä»–çš„ APIï¼Œæ¯”å¦‚ <code>NSURLConnection</code> å’Œ <code>NSURLDownload</code>ã€‚å…±åŒä½¿ç”¨çš„ç±»åŒ…æ‹¬ï¼š</p>
<ul>
<li><a href="https://developer.apple.com/reference/foundation/nsurl" target="_blank" rel="external">NSURL</a>â€”An object that contains a URL.ï¼ˆåŒ…å«äº† URL çš„å¯¹è±¡ï¼‰</li>
<li><a href="https://developer.apple.com/reference/foundation/nsurlrequest" target="_blank" rel="external">NSURLRequest</a>â€”Encapsulates metadata related to a URL request, including the URL, request method, and so on.ï¼ˆå°è£…ä¸ URL è¯·æ±‚ï¼ŒåŒ…æ‹¬ URLã€ è¯·æ±‚æ–¹æ³•ç­‰ç­‰ç›¸å…³çš„å…ƒæ•°æ®ï¼‰</li>
<li><a href="https://developer.apple.com/reference/foundation/urlresponse" target="_blank" rel="external">NSURLResponse</a>â€”Encapsulates metadata related to a serverâ€™s response to a request, such as the content MIME type and length. (å°è£…æœåŠ¡å™¨ç›¸åº”çš„è¯·æ±‚ï¼Œå¦‚ä¸ Content çš„ MIME ç±»å‹å’Œé•¿åº¦ç›¸å…³çš„å…ƒæ•°æ®)<ul>
<li><a href="https://developer.apple.com/reference/foundation/httpurlresponse" target="_blank" rel="external">NSHTTPURLResponse</a>â€”Adds additional metadata specific to HTTP requests, such as response headers.ï¼ˆç»™ HTTPè¯·æ±‚æ·»åŠ ç‰¹å®šçš„é™„åŠ å…ƒæ•°æ®ï¼Œæ¯”å¦‚ response headersï¼‰</li>
</ul>
</li>
<li><a href="https://developer.apple.com/reference/foundation/cachedurlresponse" target="_blank" rel="external">NSCachedURLResponse</a>â€”Encapsulates an URLResponse object, along with the actual body data of the serverâ€™s response, for caching purposes.ï¼ˆç”¨æ¥ç¼“å­˜æœåŠ¡å™¨å“åº”çš„ body data å°è£…çš„ä¸€ä¸ªNSURLResponseå¯¹è±¡ï¼‰</li>
</ul>
<p><strong>Authentication and TLS Customization</strong><br><strong>èº«ä»½éªŒè¯å’Œ TLS å®šåˆ¶</strong></p>
<blockquote>
<p>When a server requests authentication or provides credentials during TLS negotiation, the URL session calls methods on its delegate, allowing you to handle the authentication or certificate validation in a custom manner. The method it calls depends on whether you are handling a task-specific challenge or a session-wide challenge. Table 1 shows the difference between the two.</p>
</blockquote>
<p>å½“æœåŠ¡å™¨è¦æ±‚èº«ä»½éªŒè¯æˆ–åœ¨ TLS åå•†æœŸé—´æä¾›å‡­è¯æ—¶ï¼ŒURL Session é€šè¿‡è°ƒç”¨ä»£ç†æ–¹æ³•ï¼Œè®©ä½ å¯ä»¥è‡ªå®šä¹‰å¤„ç†èº«ä»½éªŒè¯æˆ–è¯ä¹¦éªŒè¯ã€‚<br>è°ƒç”¨çš„ä»£ç†æ–¹æ³•å–å†³äºä½ æ˜¯åœ¨å¤„ç† task ç›¸å…³è¿˜æ˜¯ sessionèŒƒå›´å†…çš„æŒ‘æˆ˜ã€‚Table 1 ç»™å‡ºäº†ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«ã€‚</p>
<blockquote>
<p>Table 1<br>Session-level and connection-level challenges</p>
</blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">Session-wide challenges</th>
<th style="text-align:center">Task-specific challenges</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><a href="">NSURLAuthenticationMethodNTLM</a></td>
<td style="text-align:center"><a href="">NSURLAuthenticationMethodDefault</a></td>
</tr>
<tr>
<td style="text-align:center"><a href="">NSURLAuthenticationMethodNegotiate</a></td>
<td style="text-align:center"><a href="">NSURLAuthenticationMethodHTTPBasic</a></td>
</tr>
<tr>
<td style="text-align:center"><a href="">NSURLAuthenticationMethodClientCertificate</a></td>
<td style="text-align:center"><a href="">NSURLAuthenticationMethodHTTPDigest</a></td>
</tr>
<tr>
<td style="text-align:center"><a href="">NSURLAuthenticationMethodServerTrust</a></td>
<td style="text-align:center">-</td>
</tr>
</tbody>
</table>
<p>å¯¹äº task ç›¸å…³çš„æŒ‘æˆ˜ï¼Œ session ä¼šè°ƒç”¨ä»£ç†çš„<br><a href="https://developer.apple.com/reference/foundation/urlsessiontaskdelegate/1411595-urlsession" target="_blank" rel="external">URLSession:task:didReceiveChallenge:completionHandler:</a> æ–¹æ³•ã€‚</p>
<p>å¯¹äº session ç›¸å…³çš„æˆæƒæŒ‘æˆ˜ï¼Œsession ä¼šè°ƒç”¨ä»£ç†çš„<br><a href="https://developer.apple.com/reference/foundation/urlsessiondelegate/1409308-urlsession" target="_blank" rel="external">URLSession:didReceiveChallenge:completionHandler:</a> æ–¹æ³•ï¼Œå¦‚æœå®ƒä¸å­˜åœ¨ï¼Œåˆ™è°ƒç”¨ä»£ç†çš„<a href="https://developer.apple.com/reference/foundation/urlsessiontaskdelegate/1411595-urlsession" target="_blank" rel="external">URLSession:task:didReceiveChallenge:completionHandler: </a>æ–¹æ³•ã€‚</p>
<blockquote>
<p>If you do not implement these methods, when a request requires client authentication, the URL session attempts to authenticate as follows:</p>
<ul>
<li>Using the authentication information provided as part of the requested URL, if available</li>
<li>By looking up Internet passwords and certificates in the userâ€™s keychain (in macOS) or the appâ€™s keychain (in iOS)</li>
</ul>
</blockquote>
<p>å½“è¯·æ±‚éœ€è¦å®¢æˆ·ç«¯æˆæƒæ—¶ï¼Œå¦‚æœä½ æ²¡æœ‰å®ç°è¿™äº›æ–¹æ³•ï¼ŒURL Session ä¼šé€šè¿‡ä¸‹é¢çš„æ–¹å¼æ¥å°è¯•æˆæƒï¼š</p>
<ul>
<li>å¦‚æœ URLä¸­å«æœ‰æˆæƒä¿¡æ¯çš„è¯ï¼Œé€šè¿‡è¯·æ±‚çš„ URL ä¸­çš„æˆæƒä¿¡æ¯ã€‚</li>
<li>åœ¨ç”¨æˆ·çš„é’¥åŒ™ä¸²ï¼ˆ åœ¨ OS X ä¸­ï¼‰æˆ–æ˜¯ app çš„é’¥åŒ™ä¸²ï¼ˆåœ¨ iOS ä¸­ï¼‰å¯»æ‰¾ç½‘ç»œå¯†ç æˆ–æ˜¯è¯ä¹¦ã€‚</li>
</ul>
<blockquote>
<p>Then, if credentials are not available, or if the server rejects the credentials, the connection continues without authenticating. For HTTP and HTTPS requests, the connection attempt fails with an appropriate HTTP status code, and may provide alternative content (such as the public version of a private site). For other URL types (such as FTP),the connection fails with a connection failure.</p>
</blockquote>
<p>å¦‚æœéªŒè¯ä¸å¯ç”¨ï¼Œæˆ–æ˜¯æœåŠ¡å™¨æ‹’ç»äº†éªŒè¯ï¼Œé‚£è¿™ä¸ªè¿æ¥å°†ä¼šåœ¨æ²¡æœ‰æˆæƒçš„æƒ…å†µä¸‹ç»§ç»­ã€‚å¯¹äº HTTP å’Œ HTTPs è¯·æ±‚æ¥è¯´ï¼Œè¿æ¥ä¼šé€šè¿‡ä¸€ä¸ªå¯¹åº”çš„ HTTP çŠ¶æ€ç ååº”å°è¯•å¤±è´¥ï¼Œ ä¹Ÿå¯èƒ½ä¼šæä¾›å¯é€‰æ‹©çš„å†…å®¹ï¼ˆæ¯”å¦‚ç§æœ‰ç½‘ç«™çš„å…¬å¼€ç‰ˆæœ¬ï¼‰ã€‚å¯¹äºå…¶ä»–ç±»å‹çš„ URLï¼ˆæ¯”å¦‚ FTPï¼‰ï¼Œå°†ä¼šç›´æ¥è¿æ¥å¤±è´¥ã€‚</p>
<blockquote>
<p>Note<br>Kerberos authentication is handled transparently. The delegate methods described here do not apply to Kerberos authentication.</p>
</blockquote>
<p>æ³¨æ„ï¼š<br>erberos èº«ä»½éªŒè¯çš„å¤„ç†æ˜¯å…¬å¼€é€æ˜çš„ã€‚è¿™é‡Œæè¿°çš„å§”æ‰˜æ–¹æ³•ä¸é€‚ç”¨äº Kerberos èº«ä»½éªŒè¯ã€‚</p>
<p><strong>App Transport Security (ATS)</strong><br><strong>App ä¼ è¾“å®‰å…¨ (ATS)</strong></p>
<blockquote>
<p>Starting in iOS 9.0 and OS X v10.11, a new security feature called App Transport Security (ATS) is enabled by default for all HTTP connections made with NSURLSession. ATS requires that HTTP connections use HTTPS (<code>RFC 2818</code>).</p>
<p>For more information, see <code>NSAppTransportSecurity</code> in the <code>Information Property List Key Reference</code>.</p>
</blockquote>
<p>ä» iOS9.0 å’Œ OS X v10.11 å¼€å§‹ï¼Œä¸€ç§ç§°ä¸ºApp ä¼ è¾“å®‰å…¨ï¼ˆATSï¼‰çš„å®‰å…¨ç‰¹æ€§åœ¨æ‰€æœ‰ç”¨ä½œ HTTP è¿æ¥çš„ NSURLSession ä¸­æ˜¯é»˜è®¤å¯ç”¨çš„ã€‚ATS è¦æ±‚ HTTP è¿æ¥ä½¿ç”¨ HTTPSï¼ˆ<a href="https://tools.ietf.org/html/rfc2818" target="_blank" rel="external">RFC 2818</a>ï¼‰ã€‚</p>
<p>æƒ³äº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·çœ‹<br><a href="https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Introduction/Introduction.html#//apple_ref/doc/uid/TP40009247" target="_blank" rel="external">Information Property List Key Reference</a> ä¸­çš„ <a href="https://developer.apple.com/library/content/documentation/General/Reference/InfoPlistKeyReference/Articles/CocoaKeys.html#//apple_ref/doc/uid/TP40009251-SW33" target="_blank" rel="external">NSAppTransportSecurity</a></p>
<p><strong>Using an URL Session</strong><br><strong>ä½¿ç”¨ URL Session</strong><br>ä½¿ç”¨ <code>NSURLSession</code> ç±»å‘èµ·ä¸€ä¸ªè¯·æ±‚:</p>
<ol>
<li><p>åˆ›å»ºä¸€ä¸ª <code>session</code> é…ç½®ã€‚è‹¥æ˜¯ç”¨ä½œåå°çš„ <code>session</code>ï¼Œè¿™ä¸ªé…ç½®å¿…é¡»åŒ…æ‹¬ä¸€ä¸ª å”¯ä¸€æ ‡è¯†ï¼ˆ<code>unique identifier</code>ï¼‰ã€‚ å­˜å‚¨è¿™ä¸ªæ ‡è¯†ï¼Œ å½“ä½ çš„ app å´©æºƒæˆ–æ˜¯è¢«ç»ˆæ­¢æˆ–æ˜¯è¢«æŒ‚èµ·æ—¶ç”¨å®ƒæ¥é‡è¿ <code>session</code>ã€‚</p>
</li>
<li><p>åˆ›å»ºä¸€ä¸ª <code>session</code>ï¼Œ æŒ‡å®šå®ƒçš„é…ç½®å¯¹è±¡ï¼Œæˆ–æ˜¯ä»£ç†ã€‚</p>
</li>
<li>åœ¨æ¯ä¸ªä»£è¡¨ä¸€ä¸ªèµ„æºè¯·æ±‚çš„ <code>session</code> ä¸­åˆ›å»º <code>task å¯¹è±¡</code>ã€‚è¿™äº› <code>task å¯¹è±¡</code>åº”è¯¥æ˜¯<br><a href="https://developer.apple.com/reference/foundation/nsurlsessiontask#//apple_ref/occ/cl/NSURLSessionTask" target="_blank" rel="external">NSURLSessionTask</a>â€”<a href="https://developer.apple.com/reference/foundation/urlsessiondatatask" target="_blank" rel="external">NSURLSessionDataTask</a>,<a href="https://developer.apple.com/reference/foundation/urlsessionuploadtask" target="_blank" rel="external">NSURLSessionUploadTask</a>, or <a href="https://developer.apple.com/reference/foundation/urlsessiondownloadtask" target="_blank" rel="external">NSURLSessionDownloadTask</a> çš„å­ç±»ï¼Œå…·ä½“ç”¨å“ªä¸ªå–å†³äºä½ æƒ³è¦åšä»€ä¹ˆã€‚</li>
</ol>
<p>æ¯ä¸ªtask å¼€å§‹æ—¶éƒ½å¤„äºæŒ‚èµ·çŠ¶æ€ã€‚ä½ çš„ App è°ƒç”¨æ¢å¤ä»»åŠ¡åï¼Œå®ƒä¼šå¼€å§‹ä¸‹è½½å…¶å¯¹åº”çš„èµ„æºã€‚</p>
<p>åœ¨ä½ å¼€å§‹ä¸€ä¸ª task ä¹‹åï¼Œsession ä¼šè°ƒç”¨å…¶ä»£ç†æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š</p>
<ol>
<li><p>å¦‚æœå’ŒæœåŠ¡å™¨åˆå§‹åŒ–æ¡æ‰‹éœ€è¦ä¸€ä¸ªè¿æ¥ level çš„æŒ‘æˆ˜ï¼ˆæ¯”å¦‚SSL çš„å®¢æˆ·ç«¯è¯ä¹¦ï¼‰ï¼ŒNSURLSession ä¼šè°ƒç”¨ <a href="https://developer.apple.com/reference/foundation/urlsessiontaskdelegate/1411595-urlsession" target="_blank" rel="external">URLSession:task:didReceiveChallenge:completionHandler: </a>æˆ–æ˜¯ <a href="https://developer.apple.com/reference/foundation/urlsessiondelegate/1409308-urlsession" target="_blank" rel="external">URLSession:didReceiveChallenge:completionHandler: </a>ä»£ç†æ–¹æ³•ï¼Œå¦‚å‰é¢çš„ <a href="">èº«ä»½éªŒè¯å’Œ TLS å®šåˆ¶</a> æ‰€è¿°ã€‚<br>äº†è§£æ›´å¤šä¸º NSURLSession å†™ä¸€ä¸ªæˆæƒä»£ç†æ–¹æ³•çš„ä¿¡æ¯ï¼Œè¯·é˜…è¯» read <a href="https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/URLLoadingSystem/URLLoadingSystem.html#//apple_ref/doc/uid/10000165i" target="_blank" rel="external">URL Session Programming Guide</a>.</p>
</li>
<li><p>å¦‚æœè¿™ä¸ª task çš„æ•°æ®æ˜¯ç”±æµæä¾›çš„ï¼ŒNSURLSession å¯¹è±¡å°†ä¼šè°ƒç”¨ä»£ç†çš„ <a href="https://developer.apple.com/reference/foundation/urlsessiontaskdelegate/1410001-urlsession" target="_blank" rel="external">URLSession:task:needNewBodyStream: </a>ä»£ç†æ–¹æ³•æ¥è·å–ä¸€ä¸ª æä¾›æ–°è¯·æ±‚çš„ body data çš„ NSInputStream å¯¹è±¡ã€‚</p>
</li>
<li><p>åœ¨åˆå§‹åŒ–ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼ˆå¦‚æœå¯ç”¨çš„è¯ï¼‰çš„ body å†…å®¹æœŸé—´ï¼Œä»£ç†ä¼šé˜¶æ®µæ€§æ¥æ”¶ <a href="https://developer.apple.com/reference/foundation/urlsessiontaskdelegate/1408299-urlsession" target="_blank" rel="external">URLSession:task:didSendBodyData:totalBytesSent:totalBytesExpectedToSend:</a> çš„å›è°ƒæ¥æŠ¥å‘Šä¸Šä¼ è¿›åº¦ï¼›</p>
</li>
<li><p>æœåŠ¡å™¨å‘é€ä¸€ä¸ªå“åº”ï¼›</p>
</li>
<li><p>å¦‚æœå“åº”è¡¨æ˜éœ€è¦æˆæƒï¼Œsession ä¼šè°ƒç”¨ä»£ç†æ–¹æ³•<br><a href="https://developer.apple.com/reference/foundation/urlsessiontaskdelegate/1411595-urlsession" target="_blank" rel="external">URLSession:didReceiveChallenge:completionHandler:</a> ï¼Œå›åˆ°æ­¥éª¤2ï¼›</p>
</li>
<li><p>å¦‚æœå“åº”æ˜¯ä¸€ä¸ª HTTP é‡å®šå‘å“åº”ï¼Œ NSURLSession å¯¹è±¡ä¼šè°ƒç”¨ä»£ç†æ–¹æ³•<br><a href="https://developer.apple.com/reference/foundation/urlsessiontaskdelegate/1411626-urlsession" target="_blank" rel="external">URLSession:task:willPerformHTTPRedirection:newRequest:completionHandler:</a> ä»£ç†æ–¹æ³•ä¼šç”¨æä¾›çš„ NSRULRequest å¯¹è±¡ï¼ˆéµå¾ªé‡å®šå‘ï¼‰ï¼Œæˆ–æ˜¯æ–°çš„ NSURLRequest å¯¹è±¡ï¼ˆå¦‚æœéœ€è¦é‡å®šå‘åˆ°ä¸€ä¸ªä¸åŒçš„ URL çš„è¯ï¼‰ï¼Œæˆ–æ˜¯ nilï¼ˆå°†æœ‰æ•ˆçš„å“åº”ä½œä¸ºé‡å®šå‘å“åº”çš„ bodyï¼Œå¹¶å°†å®ƒä½œä¸ºç»“æœè¿”å›ï¼‰ æ¥è°ƒç”¨æ‰€æä¾›çš„ completion handler ã€‚</p>
</li>
</ol>
<ul>
<li>å¦‚æœä½ å†³å®šè¿½è¸ªé‡å®šå‘ï¼Œè¿”å›æ­¥éª¤2ï¼›</li>
<li>å¦‚æœä»£ç†æ²¡æœ‰å®ç°è¿™ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªé‡å®šå‘å°†ä¼šè¢«é‡å®šå‘çš„æœ€å¤§æ•°å­—è·Ÿè¿›ã€‚</li>
</ul>
<ol>
<li><p>å¯¹äºä¸€ä¸ªé€šè¿‡è°ƒç”¨<br><a href="https://developer.apple.com/reference/foundation/urlsession/1409226-downloadtask" target="_blank" rel="external">downloadTaskWithResumeData:</a><br>æˆ– <a href="https://developer.apple.com/reference/foundation/urlsession/1411598-downloadtask" target="_blank" rel="external">downloadTaskWithResumeData:completionHandler:</a> æ–¹æ³•åˆ›å»ºçš„ï¼ˆé‡å¤ï¼‰ä¸‹è½½ä»»åŠ¡æ¥è¯´ï¼ŒNSURLSession ä¼šå¯¹ä¸€ä¸ªæ–°çš„ä»»åŠ¡å¯¹è±¡è°ƒç”¨<br><a href="https://developer.apple.com/reference/foundation/urlsessiondownloaddelegate/1408142-urlsession" target="_blank" rel="external">URLSession:downloadTask:didResumeAtOffset:expectedTotalBytes: </a>ä»£ç†æ–¹æ³•ã€‚</p>
</li>
<li><p>å¯¹äºæ•°æ®ä»»åŠ¡ï¼ŒNSURLSession ä¼šè°ƒç”¨<br><a href="https://developer.apple.com/reference/foundation/urlsessiondatadelegate/1410027-urlsession" target="_blank" rel="external">URLSession:dataTask:didReceiveResponse:completionHandler: </a>ä»£ç†æ–¹æ³•ï¼Œæ¥å†³å®šæ˜¯å¦è¦å°† æ•°æ®ä»»åŠ¡è½¬æ¢æˆä¸‹è½½ä»»åŠ¡ï¼Œç„¶åè°ƒç”¨å®Œæˆå›è°ƒæ¥ç»§ç»­æ¥æ”¶æˆ–ä¸‹è½½æ•°æ®ã€‚ å¦‚æœä½ çš„ app é€‰æ‹©å°†æ•°æ®ä»»åŠ¡è½¬æ¢æˆä¸‹è½½ä»»åŠ¡ï¼ŒNSURLSession ä¼šå°†è¿™ä¸ªæ–°çš„ä¸‹è½½ä»»åŠ¡ä½œä¸ºä¸€ä¸ªå‚æ•°æ¥è°ƒç”¨ <a href="https://developer.apple.com/reference/foundation/urlsessiondatadelegate/1409936-urlsession" target="_blank" rel="external">urlSession:dataTask:didBecomeDownloadTask:</a> ä»£ç†æ–¹æ³•ã€‚è°ƒç”¨å®Œä¹‹åï¼Œä»£ç†ä¸ä¼šä»æ•°æ®ä»»åŠ¡æ¥æ”¶åˆ°è¿›ä¸€æ­¥å›è°ƒï¼Œè€Œæ˜¯ä»ä¸‹è½½ä»»åŠ¡é‚£é‡Œæ¥æ¥æ”¶å›è°ƒï¼›</p>
</li>
<li><p>åœ¨æœåŠ¡å™¨ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œä»£ç†ä¼šå‘¨æœŸæ€§åœ°æ¥æ”¶åˆ°ä¸€ä¸ª task-level çš„å›è°ƒæ–¹æ³•æ¥æŠ¥å‘Šä¼ è¾“çš„è¿›åº¦ã€‚ å¯¹äºæ•°æ®ä»»åŠ¡ï¼Œsession ä¼šåœ¨æ¥æ”¶è¿‡ç¨‹ä¸­é€šè¿‡çœŸæ­£çš„æ•°æ®å—æ¥è°ƒç”¨<br><a href="https://developer.apple.com/reference/foundation/urlsessiondatadelegate/1411528-urlsession" target="_blank" rel="external">URLSession:dataTask:didReceiveData:</a> ä»£ç†æ–¹æ³•ã€‚<br>å¯¹äºä¸‹è½½ä»»åŠ¡æ¥è¯´ï¼Œsession ä¼šé€šè¿‡å·²ç»æˆåŠŸå†™å…¥ç£ç›˜çš„ bytes æ¥è°ƒç”¨<br><a href="https://developer.apple.com/reference/foundation/urlsessiondownloaddelegate/1409408-urlsession" target="_blank" rel="external">urlSession:downloadTask:didWriteData:totalBytesWritten:totalBytesExpectedToWrite:</a> ä»£ç†æ–¹æ³•ã€‚å¦‚æœç”¨æˆ·å‘Šè¯‰ app æ¥æš‚åœä¸‹è½½ï¼Œé€šè¿‡<a href="https://developer.apple.com/reference/foundation/urlsessiondownloadtask/1411634-cancel" target="_blank" rel="external">cancelByProducingResumeData: </a>ç„¶åï¼Œå¦‚æœç”¨æˆ·è¦æ±‚ app ç»§ç»­ä¸‹è½½ä»»åŠ¡ï¼Œå°†è¿”å›çš„æ¢å¤æ•°æ®ç»™<br><a href="https://developer.apple.com/reference/foundation/urlsession/1409226-downloadtask" target="_blank" rel="external">downloadTaskWithResumeData:</a><br>æˆ– <a href="https://developer.apple.com/reference/foundation/urlsession/1411598-downloadtask" target="_blank" rel="external">downloadTaskWithResumeData:completionHandler:</a> æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸‹è½½ä»»åŠ¡ï¼Œæ¥ç»§ç»­ä¸‹è½½ã€‚ï¼ˆè¿”å›æ­¥éª¤1ï¼‰</p>
</li>
<li><p>å¯¹äºæ•°æ®ä»»åŠ¡ï¼ŒNSURLSession å¯¹è±¡å¯èƒ½ä¼šè°ƒç”¨<br><a href="https://developer.apple.com/reference/foundation/urlsessiondatadelegate/1411612-urlsession" target="_blank" rel="external">URLSession:dataTask:willCacheResponse:completionHandler:</a> æ–¹æ³•ã€‚ä½ çš„ app åº”è¯¥æ¥å†³å®šæ˜¯å¦å…è®¸ç¼“å­˜ã€‚å¦‚æœä½ æ²¡æœ‰æ˜¯ç°åœ¨åˆæ ¼æ–¹æ³•ï¼Œé»˜è®¤ä¼šä½¿ç”¨ session çš„é…ç½®å¯¹è±¡ä¸­çš„ç¼“å­˜æ–¹æ¡ˆã€‚</p>
</li>
<li><p>å¦‚æœå“åº”æ˜¯ç”±å¤šä¸ªéƒ¨åˆ†ç»„æˆçš„ç¼–ç ï¼Œsession ä¼šåœ¨didiRecieveReponseä»£ç†è¢«å¤šæ¬¡è°ƒç”¨ä¹‹åå†æ¬¡è°ƒç”¨ didRecieveData ä»£ç†æ–¹æ³•ã€‚å¦‚æœå‡ºç°è¿™æ ·çš„æƒ…å†µï¼Œå›è°ƒæ­¥éª¤8ï¼ˆå¤„ç† didRecieveResponseå›è°ƒï¼‰</p>
</li>
<li><p>å¦‚æœä¸‹è½½ä»»åŠ¡æˆåŠŸå®Œæˆï¼Œ NSURLSession å¯¹è±¡ä¼šé€šè¿‡ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶çš„åœ°å€æ¥è°ƒç”¨ä»»åŠ¡çš„ <a href="https://developer.apple.com/reference/foundation/urlsessiondownloaddelegate/1411575-urlsession" target="_blank" rel="external">urlSessionDownloadTask:didFinishDownloadingToURL: </a>æ–¹æ³•ã€‚ä½ çš„ app å¿…é¡»ä»è¿™ä¸ªæ–‡ä»¶ä¸­è¯»å–è¿”å›çš„æ•°æ®ï¼Œæˆ–æ˜¯åœ¨è¿™ä¸ªä»£ç†æ–¹æ³• ç»“æŸä¹‹å‰å°†å®ƒç§»åˆ°ä¸€ä¸ªæ°¸ä¹…ä¿å­˜çš„åœ°å€ã€‚</p>
</li>
<li><p>ä»»åŠ¡å®Œæˆæ—¶ï¼Œ NSURLSession å¯¹è±¡ä¼šé€šè¿‡ä¸€ä¸ªé”™è¯¯å¯¹è±¡æˆ–æ˜¯ nil ï¼ˆå¦‚æœä»»åŠ¡æˆåŠŸå®Œæˆï¼‰æ¥è°ƒç”¨ <a href="https://developer.apple.com/reference/foundation/urlsessiontaskdelegate/1411610-urlsession" target="_blank" rel="external">urlSession:task:didCompleteWithError:</a><br>å¦‚æœè¿™ä¸ªä¸‹è½½ä»»åŠ¡æ˜¯å¯è¢«é‡æ–°å”¤èµ·çš„ï¼Œè¿™ä¸ª NSError å¯¹è±¡çš„ userInfo å­—å…¸ä¸­ä¼šåŒ…å« key ä¸º<br><a href="https://developer.apple.com/reference/foundation/nsurlsessiondownloadtaskresumedata" target="_blank" rel="external">NSURLSessionDownloadTaskResumeData</a>çš„å€¼ã€‚ä½ è¦å°†è¿™ä¸ªå€¼ä¼ ç»™<br><a href="https://developer.apple.com/reference/foundation/urlsession/1409226-downloadtask" target="_blank" rel="external">downloadTaskWithResumeData:</a><br>æˆ–æ˜¯ <a href="https://developer.apple.com/reference/foundation/urlsession/1411598-downloadtask" target="_blank" rel="external">downloadTaskWithResumeData:completionHandler: </a>æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸‹è½½ä»»åŠ¡ä»¥ç»§ç»­è¿™ä¸ªå·²ç»å­˜åœ¨çš„ä¸‹è½½ä»»åŠ¡ã€‚<br>å¦‚æœè¿™ä¸ªä¸‹è½½ä»»åŠ¡ä¸èƒ½è¢«é‡æ–°å”¤èµ·ï¼Œä½ çš„ app éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸‹è½½ä»»åŠ¡æ¥ä»å¤´å¼€å§‹ä¸‹è½½ã€‚<br>ä¸ç®¡æ˜¯å“ªç§æƒ…å†µï¼Œå¦‚æœä¼ è¾“å› ä»»ä½•æœåŠ¡å™¨é”™è¯¯ä»¥å¤–çš„åŸå› è€Œå¤±è´¥ï¼Œè¿”å›åˆ°æ­¥éª¤3ï¼ˆåˆ›å»ºæˆ–å”¤èµ·ä»»åŠ¡å¯¹è±¡ï¼‰ã€‚</p>
</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼š<br>NSURLSession ä¸ä¼šé€šè¿‡ error å‚æ•°è¿”å›ä»»ä½•çš„æœåŠ¡å™¨é”™è¯¯ã€‚é€šè¿‡ error å‚æ•°è¿”å›çš„é”™è¯¯åªä¼šæ˜¯æœåŠ¡å™¨ç«¯é”™è¯¯ï¼Œæ¯”å¦‚ä¸èƒ½è§£å†³ hostnameï¼Œä¸èƒ½è¿æ¥åˆ° hostã€‚error codes ä¿¡æ¯å¯åœ¨ URL Loading System Error Codes ä¸­æŸ¥è¯¢ã€‚<br>æœåŠ¡å™¨ç«¯é”™è¯¯ä¼šé€šè¿‡ NSHTTPURLResponse å¯¹è±¡ä¸­çš„HTTP çŠ¶æ€ç æ¥è¿”å›ï¼Œäº†è§£æ›´å¤šä¿¡æ¯ï¼Œè¯·é˜…è¯» <a href="https://developer.apple.com/reference/foundation/httpurlresponse" target="_blank" rel="external">NSHTTPURLREsponse</a>å’Œ <a href="https://developer.apple.com/reference/foundation/urlresponse" target="_blank" rel="external">NSURLResponse</a>çš„æ–‡æ¡£ã€‚</p>
</blockquote>
<p>14 . å¦‚æœä½ ä¸éœ€è¦ç”¨åˆ° session äº†ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ <a href="https://developer.apple.com/reference/foundation/urlsession/1411538-invalidateandcancel" target="_blank" rel="external">invalidateAndCancel</a>ï¼ˆç”¨æ¥å–æ¶ˆæœªå®Œæˆçš„ä»»åŠ¡ï¼‰æˆ–æ˜¯ <a href="https://developer.apple.com/reference/foundation/urlsession/1407428-finishtasksandinvalidate" target="_blank" rel="external">finishTasksAndInvalidate</a>(åœ¨è¿™ä¸ªå¯¹è±¡å¤±æ•ˆå‰å®Œæˆæœªå®Œæˆçš„ä»»åŠ¡)ã€‚<br>å¦‚æœä½ ä¸ä½¿è¿™ä¸ªsessionå¤±æ•ˆï¼Œå®ƒä¼šåœ¨ä½ çš„appç»ˆæ­¢æ—¶è‡ªåŠ¨æ¶ˆå¤±ï¼ˆé™¤éå®ƒæ˜¯ä¸€ä¸ªå«æœ‰æ­£åœ¨è¿›è¡Œçš„ä»»åŠ¡çš„åå° sessionï¼‰ session å¤±æ•ˆåï¼Œå½“æ‰€æœ‰æœªå®Œæˆçš„ä»»åŠ¡è¢«å–æ¶ˆæˆ–æ˜¯å®Œæˆæ—¶ï¼Œsessionä¼šè°ƒç”¨ <a href="https://developer.apple.com/reference/foundation/urlsessiondelegate/1407776-urlsession" target="_blank" rel="external">urlSession:didBecomeInvalidWithError:</a> æ–¹æ³•ã€‚å½“ä»£ç†æ–¹æ³•è¿”å›æ—¶ï¼Œsession ä¼šå¤„ç½®å¯¹ä»£ç†çš„å¼ºå¼•ç”¨ã€‚</p>
<p>å¦‚æœä½ çš„app å–æ¶ˆäº†ä¸€ä¸ªæ­£åœ¨è¿›è¡Œçš„ä¸‹è½½ä»»åŠ¡ï¼Œ å½“å‡ºç°é”™è¯¯æ—¶ï¼ŒNSURLSession å¯¹è±¡ä¼šè°ƒç”¨ä»£ç†çš„ <a href="https://developer.apple.com/reference/foundation/urlsessiontaskdelegate/1411610-urlsession" target="_blank" rel="external">URLSession:task:didCompleteWithError:</a> æ–¹æ³•ã€‚</p>
<p><strong>Background Transfer Considerations</strong><br><strong>åå°å¤„ç†æ³¨æ„äº‹é¡¹</strong><br>å› ä¸ºé‡å¯appï¼ˆæˆ–æ˜¯ç­‰å¾…ç”¨æˆ·é‡æ–°å”¤èµ·æ—¶ï¼‰ä»£ä»·æ˜¯ç›¸å½“é«˜çš„ï¼Œåœ¨åå°sessionä¸­æœ‰äº›ç‰¹æ€§æ˜¯ä¸å¯ç”¨çš„ã€‚å¦‚ä¸‹ï¼š</p>
<ul>
<li><p>session å¿…é¡»æä¾›ä¸€ä¸ªä¼ é€’äº‹ä»¶çš„ä»£ç†ï¼Œå› ä¸ºåœ¨ä¼ è¾“è¿›è¡Œä¸­appå¯èƒ½ä¼šé€€å‡ºæˆ–æ˜¯é‡å¯ï¼Œå®Œæˆäº‹ä»¶çš„å›è°ƒ Block æ˜¯ä¸æ”¯æŒçš„ã€ï¼ˆä¸ºäº†ä¸Šä¼ å’Œä¸‹è½½ï¼‰ï¼Œè¿™äº›ä»£ç†åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¡¨ç°æ˜¯ç›¸åŒçš„ï¼›</p>
</li>
<li><p>åªæœ‰ HTTP å’Œ HTTPS åè®®æ˜¯è¢«æ”¯æŒçš„ã€‚å…¶ä»–å†…ç½®çš„ç½‘ç»œåè®®å’Œç”¨æˆ·ç½‘ç»œåè®®éƒ½ä¸è¢«æ”¯æŒï¼›</p>
</li>
<li><p>åªæœ‰ä¸Šä¼ å’Œä¸‹è½½æ˜¯è¢«æ”¯æŒçš„ï¼ˆæ²¡æœ‰ data ä»»åŠ¡ï¼‰ï¼›<br>é‡å®šå‘ä¸€ç›´è¢«å…è®¸ï¼›<br>å…¨ç³»ç»ŸåŒæ—¶è¿›è¡Œçš„åå°ä¼ è¾“çš„æ•°é‡æ˜¯è¢«é™åˆ¶çš„ï¼›</p>
</li>
<li><p>å¦‚æœåå°ä»»åŠ¡æœªèƒ½æ»¡è¶³æŒ‡å®šç³»ç»Ÿååé‡é™åˆ¶ï¼Œå¯èƒ½ä¼šè¢«å–æ¶ˆã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªé•¿æœŸè¿è¡Œçš„ä»»åŠ¡åœ¨ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰å‘é€æˆ–è€…æ¥å—è¶³å¤Ÿçš„æ•°æ®ï¼Œå®ƒå¯èƒ½ä¼šè¢«å–æ¶ˆï¼Œä»¥åå†è¢«å”¤èµ·ã€‚æ‰€ä»¥ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œè®©ä¸€ä¸ªä¼ è¾“å¯è¢«é‡æ–°å”¤èµ·æ˜¯å¾ˆé‡è¦çš„ã€‚</p>
</li>
<li><p>å¦‚æœåå°ä¼ è¾“åˆå§‹åŒ–æ—¶appæ˜¯åœ¨åå°ï¼Œé‚£è¿™ä¸ªä»»åŠ¡å°†è¢«å½“åšå¯è£å‰ªçš„ã€‚æ¢è¨€ä¹‹ï¼Œå®ƒå°†è¢«å½“åš é…ç½®å¯¹è±¡çš„ <a href="https://developer.apple.com/reference/foundation/urlsessionconfiguration/1411552-isdiscretionary" target="_blank" rel="external">discretionary</a> å±æ€§ä¸º true çš„sessionä¸­çš„ä¸€ä¸ªä»»åŠ¡ã€‚</p>
</li>
</ul>
<p>å¦‚æœè¿™äº›é™åˆ¶å’Œä½  app çš„éœ€æ±‚æœ‰å†²çªï¼Œä½ å¯ä»¥åœ¨ non-background session ä¸­å°†è¿œç¨‹èµ„æºä¸‹è½½åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚è¿™æ ·ï¼Œå½“ä½ çš„ç”¨æˆ·è®©ä½ çš„ iOS app è¿›å…¥åå°æˆ–æ˜¯é€€å‡ºä½ çš„ OS X app æ—¶ï¼Œå¯ä»¥é€šè¿‡è°ƒç”¨ <a href="https://developer.apple.com/reference/foundation/urlsessiondownloadtask/1411634-cancel" target="_blank" rel="external">cacelByProducingResumeData:</a> æ–¹æ³•æ¥æš‚åœä»»ä½•è¿›è¡Œä¸­çš„ä¸‹è½½ä»»åŠ¡ã€‚å½“ç”¨æˆ·é‡æ–°è®© app è¿›å…¥å‰å°æ—¶æ¢å¤ä¸‹è½½ã€‚å¦‚æœä½ çš„ app åœ¨ä½ è·å–åˆ°ä»»ä½•æ¢å¤çš„æ•°æ®ä¹‹å‰ç»ˆæ­¢äº†ï¼Œå°±ä¸èƒ½å†æ¢å¤ä¸‹è½½äº†ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š<br>åå° session æ˜¯ä¸ºäº†ä¼˜åŒ–ä¼ è¾“å°‘é‡å¾ˆå¤§çš„èµ„æºï¼Œåœ¨å¿…è¦æ—¶å¯ä»¥è¿›è¡Œç»­ä¼ ã€‚å¦‚æœå¯ä»¥ï¼Œä½ å¯èƒ½æƒ³è¦è°ƒæŸ¥ä¼˜åŒ–æœåŠ¡å™¨ç«¯è¡Œä¸ºçš„æ–¹æ³• ï¼Œæ¥å®ç°è¿™æ ·çš„ç”¨æ³•ï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li>åœ¨ç»ˆç»“ç‚¹å‘èµ·å‘é€æˆ–æ¥æ”¶ zip æˆ– taræ ¼å¼çš„å‹ç¼©æ–‡ä»¶çš„è¯·æ±‚ï¼Œè€Œä¸æ˜¯åˆ†å¼€è°ƒç”¨å¤šæ¬¡ï¼›</li>
<li>åœ¨ç»ˆç»“ç‚¹å‘èµ·å‘é€æˆ–æ¥æ”¶åœ¨æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ä¹‹é—´çš„å¢é‡å·®å¼‚çš„è¯·æ±‚ï¼›</li>
<li>åœ¨ç»ˆç»“ç‚¹å‘èµ·ä¸€ä¸ªå¯è¿”å›ä¸Šä¼ IDçš„è¯·æ±‚ï¼Œè¿™ä¸ªIDå¯ç”¨æ¥è¿½è¸ªå’Œæ¢å¤ä¼ è¾“åˆ°æœåŠ¡å™¨çš„æ•°æ®ï¼›</li>
<li>æ·»åŠ ä¸€ä¸ªä¸­é—´çš„web æœåŠ¡å™¨ä»£ç†è¯·æ±‚åˆ°è§„èŒƒçš„webæœåŠ¡å™¨ï¼Œä»¥æ–¹ä¾¿ä»»ä½•ä¸Šè¿°ä¼˜åŒ–ã€‚</li>
</ul>
</blockquote>
<p><strong>NSCopying Behavior</strong><br>session å’Œ task å¯¹è±¡éƒ½éµä» NSCopying åè®®ï¼Œå¦‚ä¸‹ï¼š</p>
<ul>
<li>å½“ä½ çš„app æ‹·è´ä¸€ä¸ªsession æˆ–æ˜¯ task å¯¹è±¡æ—¶ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªåŒæ ·çš„å¯¹è±¡ï¼›</li>
<li>å½“ä½ çš„appæ‹·è´ä¸€ä¸ªé…ç½®å¯¹è±¡æ—¶ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªä½ å¯ä»¥ç‹¬ç«‹åœ°ä¿®æ”¹çš„æ‹·è´å¯¹è±¡ã€‚</li>
</ul>
<p><strong>Thread Safety</strong><br><strong>çº¿ç¨‹å®‰å…¨</strong><br>URL Session API è‡ªèº«å®Œå…¨æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ä½ å¯ä»¥åœ¨ä»»ä½•ä¸€ä¸ªçº¿ç¨‹ä¸Šä¸‹æ–‡ä¸­éšæ„åˆ›å»º session å’Œ taskï¼Œè€Œä¸”ï¼Œå½“ä½ çš„ä»£ç†æ–¹æ³•è°ƒç”¨æä¾›çš„ å®Œæˆå›è°ƒæ—¶ï¼Œå®ƒçš„å·¥ä½œå·²è‡ªåŠ¨è¢«å®‰æ’åœ¨æ­£ç¡®çš„ä»£ç†é˜Ÿåˆ—ä¸­ã€‚</p>
<p>æœ¬æ–‡ä¸ºã€Œç®€ä¹¦-ç™½å¼€æ°´lnã€ä½œè€…åŸåˆ›ï¼›æˆ‘çš„å†™ä½œï¼Œå¸Œæœ›èƒ½ç®€åŒ–åˆ°åˆå­¦è€…å°½å¿«å…¥é—¨å’Œè€å¸æœºç¹çå›é¡¾ ^_^.<br>åœ¨ã€Œæ—¶é—´ &amp; çŸ¥è¯† ã€æœ‰é™å†…ï¼Œæ€»ç»“çš„æ–‡ç« éš¾å…æœ‰ã€Œæœªå…¨ã€ä¸è¶³ ã€çš„åœ°æ–¹ï¼Œè¿˜æœ›å„ä½å¥½å‹æŒ‡å‡ºï¼Œä»¥æé«˜æ–‡ç« è´¨é‡ã€‚</p>
<blockquote>
<p>è­¦å‘Šï¼š<br>ä½ çš„ <a href="https://developer.apple.com/reference/foundation/urlsessiondelegate/1617185-urlsessiondidfinishevents" target="_blank" rel="external">URLSessionDidFinishEventsForBackgroundURLSession: </a>ä»£ç†æ–¹æ³•å¯èƒ½ä¼šåœ¨ç¬¬äºŒçº¿ç¨‹ä¸­è¢«è°ƒç”¨ã€‚ä½†æ˜¯ï¼Œåœ¨iOSä¸­ï¼Œä½ å®Œæˆé‚£ä¸ªæ–¹æ³•æ—¶éœ€è¦åœ¨<br><a href="https://developer.apple.com/reference/uikit/uiapplicationdelegate/1622941-application" target="_blank" rel="external">application:handleEventsForBackgroundURLSession:CompletionHandler:</a> app ä»£ç†æ–¹æ³•ä¸­è°ƒç”¨completion handlerã€‚è€Œä¸”ä½ å¿…é¡»åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨é‚£ä¸ª completion handlerã€‚</p>
</blockquote>
<hr>
<p><strong>NSURLSession</strong> æœ‰å¤ªå¤šçš„ä¸œè¥¿å€¼å¾—æˆ‘ä»¬å»å­¦ä¹ æ¨æ•²ï¼Œæ–¹æ–¹é¢é¢éƒ½é€éœ²ç€å­¦ä¹ çš„å¿…è¦æ€§ï¼Œå­¦ä¹ æ€»ç»“ï¼Œä¸€åŠ³æ°¸é€¸ï¼Œå¯¹æˆ‘ä»¬æ—¥åå¼€å‘ä¸€å®šä¼šå—ç›Šè‰¯å¤šã€‚<br>ä½œä¸ºä¸€æšæˆé•¿ä¸­çš„èœé¸Ÿï¼Œåˆ†äº«å’Œå¼€æºç²¾ç¥ï¼Œè¿˜æ˜¯å€¼å¾—å…·å¤‡çš„ã€‚</p>
<hr>
<p>ã€@ç å‘˜çœŸçˆ± : çœŸçš„ä¸ç‚¹è¿›å»é˜…è¯»ä¸€ä¸‹ â“ã€‘<br>ã€<a href="https://github.com/CustomPBWaters/Apple-OfficialTranslation-SourceAnnotation" target="_blank" rel="external">è¯‘æ–‡ &amp; æºç </a>ã€‘   ã€<a href="https://github.com/CustomPBWaters/Framework-Annotations-Tools" target="_blank" rel="external">å·¥å…·ç±»</a>ã€‘</p>
<h4 id="æœŸå¾…"><a href="#æœŸå¾…" class="headerlink" title="æœŸå¾…"></a>æœŸå¾…</h4><hr>
<ul>
<li><p>å¦‚æœåœ¨é˜…è¯»è¿‡ç¨‹ä¸­é‡åˆ° error || new ideasï¼Œå¸Œæœ›ä½ èƒ½ messages æˆ‘ï¼Œæˆ‘ä¼šåŠæ—¶æ”¹æ­£è°¢è°¢ã€‚</p>
</li>
<li><p>å¯¹è¯¥æ¨¡å—<a href="https://github.com/CustomPBWaters/Framework-Annotations-Tools/blob/master/æ”¶å½•%20%26%20æŠ•ç¨¿é¡»çŸ¥.md" target="_blank" rel="external">æˆ‘ä¼š</a> ä¸å®šæ—¶ã€æŒç»­ã€æ›´æ–°ä¸€äº› å­¦ä¹ å¿ƒå¾—ä¸æ–‡ç« ã€å®ç”¨æ‰æ˜¯ç¡¬é“ç† ^_^. ã€‚</p>
</li>
<li><p>ç‚¹å‡»å³ä¸Šè§’çš„ å–œæ¬¢ å’Œ è®¢é˜…Rss æŒ‰é’®ï¼Œå¯ä»¥æ”¶è—æœ¬ä»“åº“ï¼Œå¹¶åœ¨ Demo æ›´æ–°æ—¶æ”¶åˆ°é‚®ä»¶é€šçŸ¥ã€‚</p>
</li>
</ul>

      
    </div>


    <noscript>æ·»åŠ â€œæœ¬æ–‡ç»“æŸâ€æ ‡è®°</noscript>
    <div>
      
        

<div style="text-align:center; color:#ccc; font-size:16px; ">
 ğŸ–‹ Plain boiled water ln : æœ¬æ–‡ç»“æŸ
 &nbsp;<i class="fa fa-coffee"></i>&nbsp; 
 æ„Ÿè°¢é˜…è¯» ^_^. Need coffee?  
</div>

<div style="text-align:center; color:#ccc; font-size:16px; ">
 ğŸ‘ At this time suggest 1 minute eye exercises 
</div>




      
    </div>
    <noscript>æ·»åŠ â€œæœ¬æ–‡ç»“æŸâ€æ ‡è®°</noscript>


 

    <noscript>ç‰ˆæƒ</noscript>
    <div>
      
        
<div class="my_post_copyright">
  <script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

  <!-- JSåº“ sweetalert å¯ä¿®æ”¹è·¯å¾„ -->
  <script type="text/javascript" src="http://jslibs.wuxubj.cn/sweetalert_mini/jquery-1.7.1.min.js"></script>
  <script src="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.min.js"></script>
  <link rel="stylesheet" type="text/css" href="http://jslibs.wuxubj.cn/sweetalert_mini/sweetalert.mini.css">
  <p><span>æœ¬æ–‡æ ‡é¢˜:</span><a href="/AppleTranslation/NSURLSessionApple.html">iOS NSURLSessionAppleè¯‘æ–‡</a></p>
  <p><span>æ–‡ç« ä½œè€…:</span><a href="/" title="è®¿é—® æ— å‘³sh çš„ä¸ªäººåšå®¢">æ— å‘³sh</a></p>
  <p><span>åŸå§‹é“¾æ¥:</span><a href="/AppleTranslation/NSURLSessionApple.html" title="iOS NSURLSessionAppleè¯‘æ–‡">http://yoursite.com/AppleTranslation/NSURLSessionApple.html</a>
    <span class="copy-path"  title="ç‚¹å‡»å¤åˆ¶æ–‡ç« é“¾æ¥"><i class="fa fa-clipboard" data-clipboard-text="http://yoursite.com/AppleTranslation/NSURLSessionApple.html"  aria-label="å¤åˆ¶æˆåŠŸï¼"></i></span>
  </p>
  <p><span>ç‰ˆæƒå£°æ˜:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)">ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…</a> æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–å‡ä¸ºåŸåˆ›ï¼Œè½¬è½½è¯·åœ¨æ–‡ç« å¼€å¤´ä½ç½®æ³¨æ˜æ ¼å¼ã€ŒåŸæ–‡é“¾æ¥ - ä½œè€… - ä¿®æ”¹(å¦‚æœ‰æŒ‡å‡ºæŸéƒ¨åˆ†)ã€ï¼Œå¹¶é€šè¿‡E-mailç­‰æ–¹å¼å‘ŠçŸ¥ï¼Œè°¢è°¢åˆä½œï¼</p>  
</div>
<script> 
    var clipboard = new Clipboard('.fa-clipboard');
    clipboard.on('success', $(function(){
      $(".fa-clipboard").click(function(){
        swal({   
          title: "",   
          text: 'å¤åˆ¶æˆåŠŸ',   
          html: false,
          timer: 500,   
          showConfirmButton: false
        });
      });
    }));  
</script>

 
      
    </div>
    <noscript>ç‰ˆæƒ</noscript>


    <div>
      
        

      
    </div>

    <div>
      
        
  <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
    <div>ã€Œå–œæ¬¢å°±ç•™è¨€orèµèµã€butã€Œæ”¯æŒä¸è¦è¶…è¿‡ä½ æ—©é¤è´¹çš„ 0.5ã€ ^_^.</div>
    <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
      <span>èµ</span>
    </button>
    <div id="QR" style="display: none;">
      
        <div id="wechat" style="display: inline-block">
          <img id="wechat_qr" src="/uploads/money/wechat-reward-image.jpg" alt="æ— å‘³sh WeChat Pay"/>
          <p>å¾®Â·èµèµ</p>
        </div>
      
      
        <div id="alipay" style="display: inline-block">
          <img id="alipay_qr" src="/uploads/money/alipay-reward-image.jpg" alt="æ— å‘³sh Alipay"/>
          <p>æ”¯Â·èµèµ</p>
        </div>
      

    </div>
  </div>


      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/è¯‘æ–‡/" rel="tag"> <i class="fa fa-tag"></i> è¯‘æ–‡</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/PerceptionWork/appreciates.html" rel="next" title="èµèµç¯‡">
                <i class="fa fa-chevron-left"></i> èµèµç¯‡
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/PerceptionWork/OpenSourceTechnology.html" rel="prev" title="å¼€æºæŠ€æœ¯å˜‰å¹´åã€Œå¤œèŠã€ç¤¾åŒºï¼Œé‚€ä½ åŠ å…¥">
                å¼€æºæŠ€æœ¯å˜‰å¹´åã€Œå¤œèŠã€ç¤¾åŒºï¼Œé‚€ä½ åŠ å…¥ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



 
    <div class="post-spread">
      
        <!-- JiaThis Button BEGIN -->
<div class="jiathis_style">
  <a class="jiathis_button_tsina"></a>
  <a class="jiathis_button_weixin"></a>
  <a class="jiathis_button_cqq"></a>
  <a class="jiathis_button_copy"></a>
  <a class="jiathis_counter_style"></a>
</div>
<script type="text/javascript" >
  var jiathis_config={
    hideMore:true
  }
</script>
<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js" charset="utf-8"></script>
<!-- JiaThis Button END -->
 
      
    </div>



  </div>


          </div>
	  
  <div class="comments" id="comments">


    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8yOTQxOC81OTg2"></div>




    
 

  </div>







          


          
        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="æ— å‘³sh" />
          <p class="site-author-name" itemprop="name">æ— å‘³sh</p>
          <p class="site-description motion-element" itemprop="description">å¾è¡Œå››æ—¶äº”å‘³ï¼Œå†·æš–ä½ æˆ‘è‡ªçŸ¥.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">55</span>
              <span class="site-state-item-name">æ—¥å¿—</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
	    <a title="æ­¤æ—¶ï¼Œéœ€è¦å–ç‚¹ç™½å¼€æ°´å—ï¼Ÿ" rel="alternate" class="mw-harlem_shake_slow wobble shake" href='javascript:(
    /*
     * Copyright (C) 2015 Rocko (rocko.xyz) <rocko.zxp@gmail.com>
     *
     * Licensed under the Apache License, Version 2.0 (the "License");
     * you may not use this file except in compliance with the License.

     * Unless required by applicable law or agreed to in writing, software
     * distributed under the License is distributed on an "AS IS" BASIS,
     * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     * See the License for the specific language governing permissions and
     * limitations under the License.
     */
    function go() {

      var songs = [
          "http://m2.music.126.net/NnHwR2HV-1OoKZ6R5LVy4Q==/18502581673300023.mp3",
          "http://m2.music.126.net/qv3RI4K7ABKJ0TyAdb3taw==/3250156397064860.mp3",    
      ];

      function S() {
          var e = document.getElementById("audio_element_id");
          if(e != null){
              var index = parseInt(e.getAttribute("curSongIndex"));
              if(index > songs.length - 2) {
                  index = 0;
              } else {
                  index++;
              }
              e.setAttribute("curSongIndex", index);
          }
          e.src = i;
          e.play()
      }
      function initAudioEle() {
          var e = document.getElementById("audio_element_id");
          if(e === null){
            e = document.createElement("audio");
            e.setAttribute("curSongIndex", 0);
            e.id = "audio_element_id";
            e.loop = false;
            e.bgcolor = 0;
            e.innerHTML = " <p>If you are reading this, it is because your browser does not support the audio element. We recommend that you get a new browser.</p> <p>";
            document.body.appendChild(e);
            e.addEventListener("ended", function() {
              go();
            }, true);
          }        
      }

      initAudioEle();
      var curSongIndex = parseInt(document.getElementById("audio_element_id").getAttribute("curSongIndex"));
      var i = songs[curSongIndex];
      S();
    })()'>
    <i class="fa fa-music"></i> Music </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/SunHui-Candy" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.gitbook.com/@custompbwaters" target="_blank" title="GitBook">
                  
                    <i class="fa fa-fw fa-book"></i>
                  
                  GitBook
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/ce78ee1f9a89" target="_blank" title="csdn">
                  
                    <i class="fa fa-fw fa-scribd"></i>
                  
                  csdn
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/ce78ee1f9a89" target="_blank" title="ç®€ä¹¦">
                  
                    <i class="fa fa-fw fa-tint"></i>
                  
                  ç®€ä¹¦
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/ce78ee1f9a89" target="_blank" title="æ˜é‡‘">
                  
                    <i class="fa fa-fw fa-tint"></i>
                  
                  æ˜é‡‘
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://plainboiledwaterln.cn/PerceptionWork/appreciates.html" target="_blank" title="èµèµç¯‡">
                  
                    <i class="fa fa-fw fa-book"></i>
                  
                  èµèµç¯‡
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-sa.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        
          <div class="links-of-blogroll motion-element links-of-blogroll-inline">
            <div class="links-of-blogroll-title">
              <i class="fa  fa-fw fa-globe"></i>
              æ¬¢è¿å‹é“¾
            </div>
            <ul class="links-of-blogroll-list">
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.jianshu.com/u/fd745d76c816" title="ğŸ–¥Apple" target="_blank">ğŸ–¥Apple</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="https://githubidea.github.io" title="ğŸ› Xcode" target="_blank">ğŸ› Xcode</a>
                </li>
              
                <li class="links-of-blogroll-item">
                  <a href="http://www.jianshu.com/u/ce78ee1f9a89" title="ğŸ’¸Swift" target="_blank">ğŸ’¸Swift</a>
                </li>
              
            </ul>
          </div>
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#Write-in-the-firstã€å†™åœ¨æœ€å‰ã€‘"><span class="nav-number">1.</span> <span class="nav-text">Write in the firstã€å†™åœ¨æœ€å‰ã€‘</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ­£é¢˜"><span class="nav-number">2.</span> <span class="nav-text">æ­£é¢˜</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æœŸå¾…"><span class="nav-number">3.</span> <span class="nav-text">æœŸå¾…</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heartbeat"></i>
  </span>
  
  <span class="author" itemprop="copyrightHolder">Sun Yong Hui </span>
</div>




 
<div class="theme-info">
Sharing allows you to generate new ideas or habits . 
</div>

 

<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>




        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span>äºº</span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span>æ¬¡</span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>
	


  <!-- å°çº¢å¿ƒ -->
  <script type="text/javascript" src="/js/src/é¼ æ ‡ç‚¹å‡»æ˜¾ç¤ºçº¢å¿ƒ/love.js"></script>

  <!--å´©æºƒæ¬ºéª—-->
  <script type="text/javascript" src="/js/src/è®¾ç½®åŠ¨æ€title/dytitle.js"></script>




  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>






  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  



  




	



  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  
  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
      search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = $( "entry", xmlResponse ).map(function() {
            return {
              title: $( "title", this ).text(),
              content: $("content",this).text(),
              url: $( "url" , this).text()
            };
          }).get();
          var $input = document.getElementById(search_id);
          var $resultContent = document.getElementById(content_id);
          $input.addEventListener('input', function(){
            var matchcounts = 0;
            var str='<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length > 1) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var content_index = [];
                var data_title = data.title.trim().toLowerCase();
                var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                var data_url = decodeURIComponent(data.url);
                var index_title = -1;
                var index_content = -1;
                var first_occur = -1;
                // only match artiles with not empty titles and contents
                if(data_title != '') {
                  keywords.forEach(function(keyword, i) {
                    index_title = data_title.indexOf(keyword);
                    index_content = data_content.indexOf(keyword);
                    if( index_title >= 0 || index_content >= 0 ){
                      isMatch = true;
                      if (i == 0) {
                        first_occur = index_content;
                      }
                    }

                  });
                }
                // show search results
                if (isMatch) {
                  matchcounts += 1;
                  str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                  var content = data.content.trim().replace(/<[^>]+>/g,"");
                  if (first_occur >= 0) {
                    // cut out 100 characters
                    var start = first_occur - 20;
                    var end = first_occur + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if(start == 0){
                      end = 50;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    var match_content = content.substring(start, end);
                    // highlight all keywords
                    keywords.forEach(function(keyword){
                      var regS = new RegExp(keyword, "gi");
                      match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                    });

                    str += "<p class=\"search-result\">" + match_content +"...</p>"
                  }
                  str += "</li>";
                }
              })};
            str += "</ul>";
            if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
            if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
            $resultContent.innerHTML = str;
          });
          proceedsearch();
        }
      });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("oyPNvIS2f9841aNc4ADTGeHp-gzGzoHsz", "Sj4xG32ycBFGH2z0McIzLcjT");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>




  


</body>
</html>
